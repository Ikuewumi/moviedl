import{d as z,c as o,e as i,g as t,t as r,F as $,f as C,x as v,k as x,r as y,y as I,G as L,E as N,w as V,o as B,A as T,h as E,j as P,T as A,s as _,q as F,P as U,m as M,Q as G,a as Y,K as q,C as K}from"./index.be173f1f.js";import{a as Q}from"./Metadata.0bc40099.js";const R={key:0,class:"public","data-component-link":""},W={class:"f-size-m-big f-round","data-label":""},H={class:"grid br-6 z-2"},J=["href"],vt=z({props:{data:null},setup(a){const b=["mp4","avi","mkv"],h=l=>{let d="";const s=l.split("/"),c=s[s.length-1];return d=b.find(g=>c.endsWith(`.${g}`))?c:l,d};return(l,d)=>{var s;return(s=a.data.links)!=null&&s.length?(o(),i("div",R,[t("div",W,r(a.data.type),1),t("div",H,[(o(!0),i($,null,C(a.data.links,(c,e)=>(o(),i("a",{href:c,download:"",target:"_blank",class:"bg-white z-1","data-link":"",key:e},r(h(c)),9,J))),128))])])):v("",!0)}}});const O={class:"grid g-3 c-comments-b"},X={"data-c-comment-base":"",class:"grid g-1 pin-3 pbl-3"},Z={class:"f-round"},tt={key:0,class:"admin"},et={"data-second-ring":"",class:"grid g-4"},at=t("h5",null,[t("span",{class:"f-emoji"},"\u261D")],-1),nt={class:"f-round"},ot={key:0,class:"admin"},st=z({props:{comment:null},emits:["pin"],setup(a,{emit:b}){const h=a,l=s=>{if(typeof s=="number")return new Date(s).toLocaleDateString([],{month:"long",day:"2-digit",year:"numeric"})},d=()=>{b("pin",h.comment._id)};return(s,c)=>(o(),i("div",O,[t("div",X,[t("div",{class:"bar cursor f-emoji",onClick:d}," \u{1F517} "),t("h3",Z,[x(r(a.comment.name)+" ",1),a.comment.admin?(o(),i("span",tt,"ADMIN")):v("",!0)]),t("small",null,r(l(a.comment.timestamp)),1),t("p",null,r(a.comment.content),1)]),t("div",et,[(o(!0),i($,null,C(a.comment.comments,(e,g)=>(o(),i("div",{class:"grid g-1 pin-2 pbl-3",key:g,"data-c-comment-base":""},[at,t("h3",nt,[x(r(e.name)+" ",1),e.admin?(o(),i("span",ot,"ADMIN")):v("",!0)]),t("small",null,r(l(e.timestamp)),1),t("p",null,r(e.content),1)]))),128))])]))}});const it={class:"pt-8 mt-8 mb-8 pb-8","data-top":""},rt={class:"grid g-3","data-c-comments":""},lt=t("h1",{class:"f-round f-size-big c-blue-d"},"Comments",-1),dt=["onSubmit"],ct={class:"flex a-center j-center",id:"pinned-user"},mt=t("div",null,[t("button",{type:"submit",class:"btn pbl-2 pin-3 bg-blue c-white f-size-normal br-3"},[t("span",{class:"f-emoji"},"\u2712"),x(" Post Comment ")])],-1),ut={key:0},pt=t("div",{class:"mb-3"},null,-1),bt={class:"f-round f-size-a-big underline pl-1 c-blue-d"},ht={class:"grid g-3"},_t=z({props:{imdbID:null},async setup(a){let b,h;const l=a,d={from:{yPercent:-10,opacity:.4,zIndex:-1,duration:1,ease:"elastic"},to:{yPercent:0,opacity:1,zIndex:0,duration:1,ease:"cosine"}},[s,c]=G(d.from,d.to);let e=y("");const g=I(),w=L();N();let f=y([]);const D=async()=>{try{const n=await Y(`comments/${l.imdbID}`);f.value=n!=null?n:[];return}catch(n){w.show(String(n),!0)}};[b,h]=V(()=>D()),await b,h();let m=y({});const k=n=>{const p=f.value.find(u=>u._id===n);p?m.value=p:m.value={}},S=async()=>{try{if(!g.getUser._id)throw Error("You must be logged in to comment");if(e.value.trim()==="")throw Error("The comment field can't be empty");m!=null&&m.value.aid?await q(`comments/${m.value._id}`,{content:e.value}):await K(`comments/${l.imdbID}`,{content:e.value},!0),await D()}catch(n){w.show(String(n),!0)}finally{e.value="",k("")}};return B(n=>{w.show(String(n),!0)}),(n,p)=>(o(),i("div",it,[t("div",rt,[lt,t("form",{onSubmit:T(S,["prevent"]),class:"grid g-3"},[E(Q,{p:"Comment here...",class:"mt-3",modelValue:e.value,"onUpdate:modelValue":p[1]||(p[1]=u=>e.value=u)},{more:P(()=>[E(A,{onEnter:_(s),onLeave:_(c)},{default:P(()=>{var u;return[F(t("div",ct,[t("span",null,"Replying to "+r(_(m).name),1),t("small",{onClick:p[0]||(p[0]=j=>k("")),class:"cursor"},"\u274C")],512),[[U,(u=_(m))==null?void 0:u.aid]])]}),_:1},8,["onEnter","onLeave"])]),_:1},8,["modelValue"]),mt],40,dt),f.value.length?(o(),i("div",ut,[pt,t("h2",bt,r(f.value.length)+" Comments",1),t("div",ht,[f.value.length?(o(!0),i($,{key:0},C(f.value,(u,j)=>(o(),M(st,{onPin:k,comment:u,class:"mt-3"},null,8,["comment"]))),256)):v("",!0)])])):v("",!0)])]))}});export{_t as _,vt as a};
