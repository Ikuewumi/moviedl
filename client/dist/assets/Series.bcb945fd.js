import{d as A,O as w,c as l,e as m,F as I,f as V,g as u,t as L,m as C,s as $,r as S,R as E,q as F,v as j,Y as U,x as B,u as P,i as N,l as R,w as T,X,y as Y,b as H,j as J,h as M,D as K,a as O}from"./index.be173f1f.js";import{a as q,_ as Q}from"./Comments.db00f8fd.js";import{_ as W}from"./Metadata.0bc40099.js";const Z={class:"g-7 br-6","data-c-index":""},ee={class:"f-round f-size-m-big weight-bold case-upper pin-3 pbl-3"},ae=A({props:{data:Array},setup(z){const g=z,f=w(()=>{var d;const b=[],c=(d=g.data)==null?void 0:d.filter(p=>p.links.length>0);return c==null||c.forEach(p=>{const s=[];p.links.forEach((i,k)=>{const _=s.findIndex(h=>h.type===i.type);function D(h,x){return x.filter(e=>!h.includes(e))}_===-1?s.push({type:i.type,links:i.links}):s[_].links.push(...D(s[_].links,i.links))}),b.push({season:p.season,links:s})}),b});return(b,c)=>(l(),m("div",Z,[(l(!0),m(I,null,V($(f),(d,p)=>(l(),m("div",{key:p,class:"grid","data-index":""},[u("h2",ee,"Season "+L(d.season),1),(l(!0),m(I,null,V(d.links,(s,i)=>(l(),C(q,{key:i,data:s,class:"pin-3"},null,8,["data"]))),128))]))),128))]))}});const te={class:"grid g-3 pbl-4","data-c-seasons-view":""},ie={class:"flex flex-wrap g-2 a-center f-size-a-big f-round"},ne=["onClick"],se={class:"flex a-center flex-wrap g-2 mt-2"},de={"data-select":""},oe=u("option",{value:"episode"},"episode",-1),re=u("option",{value:"batch"},"batch",-1),le=u("option",{value:"special"},"special",-1),ue=[oe,re,le],ce={key:0,"data-select":""},pe={class:"g-3 mt-3","data-links":""},me=A({props:{data:Array},setup(z){var h,x,v;const g=z,f=w(()=>{var t;const e=(t=g.data)==null?void 0:t.filter(n=>n.links.length>0);return e!=null?e:[]}),b=w(()=>{var e;return(e=g.data)==null?void 0:e.find(t=>t.season===s.value.i)}),c=w(e=>{var o;let t=[];const n=(o=b.value)==null?void 0:o.links.filter(a=>a.id==="episode");return n==null||n.forEach(a=>{if(a.id!=="episode")return;const r=t.findIndex(y=>y.number===a.number);if(r===-1)t.push({id:"episode",number:a.number,links:[{type:a.type,links:a.links}]});else{const y=t[r].links.findIndex(G=>G.type===a.type);y===-1?t[r].links.push({type:a.type,links:a.links}):t[r].links[y].links.push(...p(t[r].links[y].links,a.links))}}),t=t.sort((a,r)=>a.number-r.number),t}),d=e=>{var o;let t={id:e,links:[]};const n=(o=b.value)==null?void 0:o.links.filter(a=>a.id===e);return n==null||n.forEach(a=>{if(!["special","batch"].includes(a.id))return;const r=t.links.findIndex(y=>y.type===a.type);r===-1?t.links.push({type:a.type,links:a.links}):t.links[r].links.push(...p(t.links[r].links,a.links))}),t};function p(e,t){return t.filter(o=>!e.includes(o))}const s=S({i:Number((x=(h=f.value[0])==null?void 0:h.season)!=null?x:0),id:"episode",episodeNumber:null,episodesArray:[]}),i=w({get(){var e;return(e=s.value.id)!=null?e:"episode"},set(e){s.value.id=e}}),k=w({get(){var e,t;if(s.value.id==="episode"){const n=f.value[0].links.find(a=>a.id==="episode");let o=0;return(n==null?void 0:n.id)==="episode"&&(o=n.number),(t=(e=s.value.episodeNumber)!=null?e:o)!=null?t:1}},set(e){var t;s.value.episodeNumber=(t=Number(e))!=null?t:null}}),_=w(()=>{if(s.value.id==="episode")return c.value.find(e=>e.number===k.value);{const e=s.value.id==="batch"?"batch":"special";return d(e)}});function D(e){s.value.i=e}return(v=S(c.value[0].number))!=null,(e,t)=>{var n,o;return l(),m("div",te,[u("div",ie,[(l(!0),m(I,null,V($(f),a=>(l(),m("span",{class:E(["season br-5 pin-3 pbl-1 bg-bt cursor",s.value.i===a.season?"active":""]),onClick:r=>D(a.season),key:a},L(a.season),11,ne))),128))]),u("div",se,[u("div",de,[F(u("select",{name:"id",class:"bg-white","onUpdate:modelValue":t[0]||(t[0]=a=>U(i)?i.value=a:null)},ue,512),[[j,$(i)]])]),s.value.id==="episode"?(l(),m("div",ce,[F(u("select",{name:"number",class:"bg-white","onUpdate:modelValue":t[1]||(t[1]=a=>U(k)?k.value=a:null)},[(l(!0),m(I,null,V($(c),(a,r)=>(l(),m("option",{key:r},L(a.number),1))),128))],512),[[j,$(k)]])])):B("",!0)]),u("div",pe,[(l(!0),m(I,null,V((o=(n=$(_))==null?void 0:n.links)!=null?o:[],(a,r)=>(l(),C(q,{key:r,data:a},null,8,["data"]))),128))])])}}});const ve={key:0,class:"relative","data-page-movie":""},be=u("span",{class:"f-e f-size-tiny"},"\u270F",-1),ge={class:"grid g-4","data-component-metadata":""},fe={class:"mt-9 mb-9","data-padded":""},he={class:"widget w-full grid g-2 text-center f-round f-size-medium mt-4","data-padded":""},ye=A({props:["id"],async setup(z){var x;let g,f;const b=z,c=P();let d=S({}),p=N("wrapFn"),s=N("pinia"),i=S({pinia:s(),title:N("title"),type:"series",indexView:!0,isLoaded:R(()=>{var v,e,t,n,o;return d.value?(((e=(v=d.value)==null?void 0:v._id)==null?void 0:e.length)===24&&i.value.title((t=d.value)==null?void 0:t.Title),((o=(n=d.value)==null?void 0:n._id)==null?void 0:o.length)===24):!1}),imdbID:R(()=>K.imdbId.test(b.id)?b.id:(i.value.pinia.toast.show("Invalid imdbID",!0),!1))});i.value.title("Series Page");const k=async()=>await O(`public/${i.value.type}/${i.value.imdbID}`);d.value=(x=([g,f]=T(()=>p("Loading Series details...",k)),g=await g,f(),g))!=null?x:{};const _=async()=>{var e;console.log("fired"),d.value={};const v=async()=>await O(`public/${i.value.type}/${c.params.id}`);d.value=(e=await p("Loading Movie details",v))!=null?e:{}};X(c,()=>{c.name==="series"&&c.params.id!==b.id&&(console.log("changed"),_())});const D=v=>new Date(v).toLocaleDateString([],{month:"long",day:"2-digit",year:"numeric"}),h=Y();return onErrorCaptured(),(v,e)=>{var n,o,a;const t=H("router-link");return i.value.isLoaded?(l(),m("div",ve,[(n=$(h).getUser)!=null&&n.admin?(l(),C(t,{key:0,to:`/edit?type=series&imdbid=${d.value.imdbID}`,class:"bar absolute pin-4 pbl-2 f-size-medium c-white bg-blue br-4 flex a-center j-center g-2"},{default:J(()=>[be]),_:1},8,["to"])):B("",!0),u("div",ge,[M(W,{data:d.value},null,8,["data"])]),u("time",fe,"Last updated on: "+L(D((a=(o=d.value)==null?void 0:o.updatedAt)!=null?a:"")),1),u("section",he,[u("span",{class:E(["pbl-3 pin-2 f-round br-4 cursor bg-gray-l",i.value.indexView?"active":""]),onClick:e[0]||(e[0]=r=>i.value.indexView=!0)},"index",2),u("span",{class:E(["pbl-3 pin-2 f-round br-4 cursor bg-gray-l",i.value.indexView?"":"active"]),onClick:e[1]||(e[1]=r=>i.value.indexView=!1)},"seasons",2)]),i.value.indexView?(l(),C(ae,{key:1,data:d.value.SeriesLinks,"data-padded":"",class:"pbl-5"},null,8,["data"])):(l(),C(me,{key:2,data:d.value.SeriesLinks,"data-padded":""},null,8,["data"])),M(Q,{imdbID:i.value.imdbID,"data-padded":""},null,8,["imdbID"])])):B("",!0)}}});export{ye as default};
